---
layout: post
title: "Rubyにおけるインクリメント"
tags : [Ruby]
date: 2012-10-25 23:32:15+09:00
---


以前、[rbenvをインストール](../../../08/19/install-rails-by-rbenv/)してから、
Rubyを勉強している。

といっても、
Railsちょっとやったり、
[プログラミング言語 Ruby](http://www.amazon.co.jp/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E8%A8%80%E8%AA%9E-Ruby-%E3%81%BE%E3%81%A4%E3%82%82%E3%81%A8-%E3%82%86%E3%81%8D%E3%81%B2%E3%82%8D/dp/4873113946)を読んだり、
WEBrickのソースを読んだりしてるだけで、
あまり何かを書いているわけではないが。


そんな中、今日初めて知ったことだが、
Rubyには、インクリメント演算子（++）がない。

```ruby
a = 4
a++   # -> エラー
a+=1 # -> OK
```

へぇー、そうなんだ。

Rubyはまつもとゆきひろ（通称：Matz）がこだわって作ったオブジェクト指向言語だから、
何か理由があるんだろうなと思う。
ただ単純にないことより、そっちのほうが気になって調べてみた。

[インクリメント演算子 - imHo](http://d.hatena.ne.jp/mokehehe/20070920/increment)
[http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-list/126](http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-list/126)
[Rubyにインクリメンタル演算子がない理由は？](http://okwave.jp/qa/q4634346.html)


まあ、当然Ruby界隈では何度も話されていることらしく、色々見つかった。

まとめると、

1. Rubyは純粋オブジェクト指向言語である。
2. インクリメント演算子++は、a++のように記述できるが、これは変数に対するメソッド呼び出し（正確にいうとメッセージを送信）にあたる。
3. その場合、aがオブジェクトでなければならない。
4. ここでいうaはFixnumオブジェクトなどの、同じ値は同じ参照を持ったオブジェクトなので、

a++とどこかに書くことで、その実行されている環境全ての同じ値の意味が変わってしまう。
たとえば、a == 1 ならば、a++とすることで、それ以降、実行環境内では1 == 2となってしまう。

ということだ。
1 == 2なんて、アンサイクロペディアじゃあるまいし。(笑)
参考：[1=2](http://ja.uncyclopedia.info/wiki/1%3D2)


なるほど、理由は分かった。
しかも、上記の[Rubyにインクリメンタル演算子がない理由は？](http://okwave.jp/qa/q4634346.html)にもあるように、
Rubyの設計思想から、
「破壊的に見えるメソッドが Numeric などに実装されるのは、それがシンタックスシュガーといえどやはり整合性に欠け好ましくない」
というのも理解できた。

まあ、別にa++だろうが、a=+1だろうが、たいした違いだとは思わないしね。
っていうかRubyはループとかはほとんどeachだから、インクリメントすることなんてあまりなさそうだしね。




だけど、一つだけ疑問が。
a+=1 が、Rubyの内部で a = a + 1 と変換されるらしいけど、
これって、破壊的操作をNumericなどに実装していることにならないの？
Numericに実装はしていないのだとしたら、
a++ も同様に変換してしまえばいいのではないの？

うーん、構文解析などの他の理由がある気がする。
誰か教えてエロい人。というか、エロいRubyist。



